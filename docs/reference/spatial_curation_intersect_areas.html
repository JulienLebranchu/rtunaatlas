<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Perform spatial intersection with a geospatial layer — spatial_curation_intersect_areas • rtunaatlas</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rtunaatlas</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ptaconet/rtunaatlas">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform spatial intersection with a geospatial layer</h1>
    </div>

    
    <p>This function performs the spatial intersection between a georeferenced dataset (input layer) and a georeferenced code list stored in Sardara database (intersection layer). It provides the features of the intersection layer that intersect the features of the input layer, along with the proportion of the area of the input layer feature being intersected by the intersection layer feature.</p>
    

    <pre class="usage"><span class='fu'>spatial_curation_intersect_areas</span>(<span class='no'>con</span>,<span class='no'>df_input</span>,<span class='no'>df_spatial_code_list_name</span>,<span class='no'>intersection_spatial_code_list_name</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>con</th>
      <td><p>a wrapper of rpostgresql connection (connection to a database)</p></td>
    </tr>
    <tr>
      <th>df_input</th>
      <td><p>data.frame of fact. The dataframe must have at least a column 'geographic_identifier'. The code list used for the column 'geographic_identifier' must be one of the table of the schema 'area' of the database.</p></td>
    </tr>
    <tr>
      <th>df_spatial_code_list_name</th>
      <td><p>string . Name of the code list used for the column 'geographic_identifier' of <code>df_input</code> (type polygon)</p></td>
    </tr>
    <tr>
      <th>intersection_spatial_code_list_name</th>
      <td><p>string .  Name of the intersection layer to use (type polygon). Corresponds to the name of the table in the database.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a list with 2 objects:</p><ul>
<li><p>"df": <code>df_input</code> with additional columns:
 <ul>
<li><p>"geographic_identifier_intersection_layer":  Code of the feature from the intersection layer (<code>intersection_spatial_code_list_name</code>) that intersects the geographical identifier of <code>df_input</code></p></li>
<li><p>"proportion_intersection":  Proportion of the area of the <code>df_input</code> feature being intersected by the intersection layer feature.</p></li>
</ul></p></li>
<li><p>"df_input_areas_intersect_intersection_layer": <code>a data.frame summarizing the results of the spatial intersection. The columns are: </code>
 <ul>
<li><p>"geographic_identifier_source_layer":  Code of the feature (geographic identifier) from <code>df_input</code></p></li>
<li><p>"geographic_identifier_intersection_layer":  Code of the feature from (<code>intersection_spatial_code_list_name</code>) that intersects the feature of <code>df_input</code></p></li>
<li><p>"codelist_source_layer":  Name of the code list used for the column 'geographic_identifier' of <code>df_input</code></p></li>
<li><p>"codelist_intersection_layer":  Name of the intersection layer code list (<code>intersection_spatial_code_list_name</code>)</p></li>
<li><p>"proportion_intersection":  Proportion of the area of the input layer feature being intersected by the intersection layer feature.</p></li>
</ul></p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>User has to be aware that the intersection might return several rows for 1 given row of <code>df_input</code>. This happens when one spatial feature of the input layer intersects several features of the intersection layer. Hence, the values of the ouput dataset might not be summed directly.
Example:</p>
<p>1 row of <code>df_input</code>:</p><table><tr><td>
flag	</td>
<td> time_start	</td>
<td> time_end	  </td>
<td> geographic_identifier	</td>
<td> gear	</td>
<td> species	</td>
<td> value</td>
</tr><tr><td>
AUS	</td>
<td> 1992-02-01	</td>
<td> 1992-03-01	</td>
<td> 235140	</td>
<td> LL	</td>
<td> YFT	</td>
<td> 0.05 </td>
</tr></table>
    <p>When executing the function <code>function spatial_curation_intersect_areas</code> taking as intersection layer "fao_fishing_areas", the output dataset will return 2 rows:</p><table><tr><td>
flag	</td>
<td> time_start	</td>
<td> time_end	  </td>
<td> geographic_identifier	</td>
<td> gear	</td>
<td> species	</td>
<td> value </td>
<td>  geographic_identifier_intersection_layer </td>
<td> proportion_intersection </td>
</tr><tr><td> 
AUS	</td>
<td> 1992-02-01	</td>
<td> 1992-03-01	</td>
<td> 235140	</td>
<td> LL	</td>
<td> YFT	</td>
<td> 3.2 </td>
<td> F51 </td>
<td> 0.5 </td>
</tr><tr><td> 
AUS	</td>
<td> 1992-02-01	</td>
<td> 1992-03-01	</td>
<td> 235140	</td>
<td> LL	</td>
<td> YFT	</td>
<td> 3.2 </td>
<td> F57 </td>
<td> 0.5 </td>
</tr></table>
    <p>This table means that the geograpical identifier "235140" intersects two areas of the intersection layer: "F51" with 50<!-- % of the area of 235140 being intersected by F51, and "F57" with 50% of the area of 235140 being intersected by F57. However, the value of catch is 3.2 in both cases - i.e. it has not been multiplied by the proportion of area intersected. --></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>Other create your own tuna atlas: <code><a href='convert_units.html'>convert_units</a></code>,
  <code><a href='map_codelist.html'>map_codelist</a></code>,
  <code><a href='raise_datasets_by_dimension.html'>raise_datasets_by_dimension</a></code>,
  <code><a href='raise_get_rf.html'>raise_get_rf</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='no'>con</span><span class='kw'>=</span><span class='fu'><a href='db_connection_sardara_world.html'>db_connection_sardara_world</a></span>()

<span class='co'># Extract a dataset</span>
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='extract_dataset.html'>extract_dataset</a></span>(<span class='no'>con</span>,<span class='fu'><a href='list_metadata_datasets.html'>list_metadata_datasets</a></span>(<span class='no'>con</span>,<span class='kw'>dataset_name</span><span class='kw'>=</span><span class='st'>"indian_ocean_effort_1970_01_01_2015_08_01_tunaatlasIOTC_2017_level0_coastal"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in nrow(metadata_dataset): impossible de trouver la fonction "list_metadata_datasets"</span></div><div class='input'>
<span class='co'># Get spatial coding systemd used in the dataset</span>
<span class='no'>df_spatial_codingsystem</span> <span class='kw'>&lt;-</span> <span class='no'>TODO</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): objet 'TODO' introuvable</span></div><div class='input'>
<span class='co'># Get geospatial layers available in the database</span>
<span class='no'>spatial_code_lists_available</span><span class='kw'>&lt;-</span><span class='fu'><a href='list_metadata_datasets.html'>list_metadata_codelists</a></span>(<span class='no'>con</span>,<span class='kw'>dimension</span><span class='kw'>=</span><span class='st'>"area"</span>)</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): impossible de trouver la fonction "list_metadata_codelists"</span></div><div class='input'>
<span class='co'># Intersect df with continents (to check which data are located on land areas)</span>
<span class='no'>df_intersect_continents</span><span class='kw'>&lt;-</span><span class='fu'>spatial_curation_intersect_areas</span>(<span class='no'>con</span>,<span class='kw'>df_input</span><span class='kw'>=</span><span class='no'>df</span>,<span class='kw'>df_spatial_code_list_name</span><span class='kw'>=</span><span class='no'>df_spatial_codingsystem</span>,<span class='kw'>intersection_spatial_code_list_name</span><span class='kw'>=</span><span class='st'>"gshhs_world_coastlines"</span>)</div><div class='output co'>#&gt; Ignore warning message 'unrecognized PostgreSQL field type unknown'</div><div class='output co'>#&gt; <span class='error'>Error in df_input$geographic_identifier: objet de type 'closure' non indiçable</span></div><div class='input'>
<span class='fu'>head</span>(<span class='no'>df_intersect_continents</span>$<span class='no'>df</span>)</div><div class='output co'>#&gt; <span class='error'>Error in head(df_intersect_continents$df): objet 'df_intersect_continents' introuvable</span></div><div class='input'><span class='fu'>head</span>(<span class='no'>df_intersect_continents</span>$<span class='no'>df_input_areas_intersect_intersection_layer</span>)</div><div class='output co'>#&gt; <span class='error'>Error in head(df_intersect_continents$df_input_areas_intersect_intersection_layer): objet 'df_intersect_continents' introuvable</span></div><div class='input'>
<span class='co'># Intersect df with EEZ (to know what percentage of df is located on EEZs)</span>
<span class='no'>df_intersect_eez</span><span class='kw'>&lt;-</span><span class='fu'>spatial_curation_intersect_areas</span>(<span class='no'>con</span>,<span class='kw'>df_input</span><span class='kw'>=</span><span class='no'>df</span>,<span class='no'>df_spatial_code_list_name</span>,<span class='kw'>intersection_spatial_code_list_name</span><span class='kw'>=</span><span class='st'>"vliz_world_eez_v8_2014"</span>)</div><div class='output co'>#&gt; Ignore warning message 'unrecognized PostgreSQL field type unknown'</div><div class='output co'>#&gt; <span class='error'>Error in df_input$geographic_identifier: objet de type 'closure' non indiçable</span></div><div class='input'>
<span class='fu'>head</span>(<span class='no'>df_intersect_eez</span>$<span class='no'>df</span>)</div><div class='output co'>#&gt; <span class='error'>Error in head(df_intersect_eez$df): objet 'df_intersect_eez' introuvable</span></div><div class='input'><span class='fu'>head</span>(<span class='no'>df_intersect_eez</span>$<span class='no'>df_input_areas_intersect_intersection_layer</span>)</div><div class='output co'>#&gt; <span class='error'>Error in head(df_intersect_eez$df_input_areas_intersect_intersection_layer): objet 'df_intersect_eez' introuvable</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Paul Taconet, <a href='mailto:paul.taconet@ird.fr'>paul.taconet@ird.fr</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Paul Taconet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
