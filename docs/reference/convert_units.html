<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Convert units of measure in a fact dataset — convert_units • rtunaatlas</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rtunaatlas</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ptaconet/rtunaatlas">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert units of measure in a fact dataset</h1>
    </div>

    
    <p>This function converts the units of measure in a fact dataset using a dataset of factors of conversions between units. The data frames of fact and of factors of conversions must be properly structured. For structures of data frames, see details and here: <a href='http://'>http://</a>.</p>
    

    <pre class="usage"><span class='fu'>convert_units</span>(<span class='no'>df_input</span>, <span class='no'>df_conversion_factor</span>, <span class='no'>codelist_geoidentifiers_conversion_factors</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df_input</th>
      <td><p>a data.frame of fact</p></td>
    </tr>
    <tr>
      <th>df_conversion_factor</th>
      <td><p>a data.frame of factors of conversion between units</p></td>
    </tr>
    <tr>
      <th>codelist_geoidentifiers_conversion_factors</th>
      <td><p>NULL or string. The name of the coding system for the spatial dimension used in df_conversion_factor (i.e. table name in Sardara database), or NULL if the coding system for the spatial dimension is the same as the one used in df_input</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The data frame of factors of conversion between units (df_conversion_factor) must have the following structure:
- several columns of dimension, that stratify the factor of conversion (e.g. species, gear, etc.),
- one column named 'unit', that provides the code of the source unit of the conversion factor,
- one column named 'unit_target', that provides the code of the target unit of the conversion factor,
- one column named 'conversion_factor', that provides the numerical factor of conversion to convert the measure from the unit stated in the column 'unit' to the unit stated in the column 'unit_target'.
See an example of dataset of factors of conversion here: <a href='https://goo.gl/KriwxV'>https://goo.gl/KriwxV</a>.</p>
<p>Example: These are the first rows of a dataset of factors of conversions:</p>
<p></p><table><tr><td>
 source_authority   </td>
<td> species </td>
<td>    gear </td>
<td>  geographic_identifier </td>
<td>  time_start  </td>
<td>  time_end    </td>
<td>   unit </td>
<td>    unit_target  </td>
<td>   conversion_factor</td>
</tr><tr><td>
 IOTC            </td>
<td>    YFT  </td>
<td>      LL </td>
<td>    1      </td>
<td>                 1952-01-01 </td>
<td>   1953-01-01 </td>
<td>    NO   </td>
<td>    MT    </td>
<td>          0.048060001</td>
</tr><tr><td>
 IOTC            </td>
<td>    YFT   </td>
<td>     LL </td>
<td>    2       </td>
<td>                1952-01-01  </td>
<td>  1953-01-01   </td>
<td>  NO   </td>
<td>    MT    </td>
<td>          0.048680000</td>
</tr><tr><td>
 IOTC            </td>
<td>    YFT   </td>
<td>     LL </td>
<td>    3       </td>
<td>                1952-01-01  </td>
<td>  1953-01-01  </td>
<td>   NO   </td>
<td>    MT     </td>
<td>         0.058639999</td>
</tr></table>
    <p>The first row means that for the combination of dimensions:  source_authority=IOTC, species=YFT, gear=LL, geographical_identifier=1, starting date of validity of the factor of conversion (time_start)=1952-01-01, ending date of validity of the factor of conversion (time_start)=1953-01-01, the factor of conversion to convert a measure from unit=NO to target_unit=MT is equal to 0.048060001</p> 
<p>The codes used in the dimensions of the dataset of factors of conversion (df_conversion_factor) must be the same as the ones used in the dataset of fact with units to convert (df_input), except for the spatial dimension (geographic_identifier) - see here-after for more details.
 The only mandatory columns of the dataset of factors of conversion are "unit", "unit_target" and "conversion_factor". All the other columns are here to stratify the factors of conversion (by species, gear, time, space, etc.).
 Particularly, the columns "time_start", "time_end" and "geographic_identifier" allow to stratify spatialy and temporarily the factors of conversion.</p> 
<p>The columns "time_start" and "time_end" provide respectively the starting date and the ending date of validity of the factor of conversion.</p> 
<p>The column "geographic_identifier" provides the spatial stratification of the factor of conversion. If the coding system for spatial stratification used in df_conversion_factor is the same as the one used in df_input, then the parameter codelist_geoidentifiers_conversion_factors must be set to NULL. Else, the spatial coding system used in df_conversion_factor must be stored in the Sardara database, and the parameter codelist_geoidentifiers_conversion_factors must be set to the name of the spatial coding system (table) in Sardara DB.</p> 
<p>If df_conversion_factor mixes factors of conversion that have and do not have a spatial stratification, the rows that do not have spatial stratification must be set to geographic_identifier= 0.</p>
<p>Columns of time (time_start and time_end) must be of type character (not Posix) and they must have the same resolution (e.g. day, second. etc).</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>Other create your own tuna atlas: <code><a href='map_codelist.html'>map_codelist</a></code>,
  <code><a href='raise_datasets_by_dimension.html'>raise_datasets_by_dimension</a></code>,
  <code><a href='raise_get_rf.html'>raise_get_rf</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Connect to Sardara World DB</span>
<span class='no'>con</span><span class='kw'>=</span><span class='fu'>db_connection_sardara_world</span>()</div><div class='output co'>#&gt; <span class='message'>Loading required package: DBI</span></div><div class='input'>
<span class='co'># Retrieve IOTC georeferenced catch data from 2017</span>
<span class='no'>df_input</span><span class='kw'>&lt;-</span><span class='fu'><a href='iotc_catch_level0.html'>iotc_catch_level0</a></span>(<span class='fl'>2017</span>)</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): impossible de trouver la fonction "iotc_catch_level0"</span></div><div class='input'>
<span class='co'># some curation before use of the functions</span>
<span class='no'>df_input</span>$<span class='no'>time_start</span><span class='kw'>&lt;-</span><span class='fu'>substr</span>(<span class='fu'>as.character</span>(<span class='no'>df_input</span>$<span class='no'>time_start</span>), <span class='fl'>1</span>, <span class='fl'>10</span>)</div><div class='output co'>#&gt; <span class='error'>Error in substr(as.character(df_input$time_start), 1, 10): objet 'df_input' introuvable</span></div><div class='input'><span class='no'>df_input</span>$<span class='no'>time_end</span><span class='kw'>&lt;-</span><span class='fu'>substr</span>(<span class='fu'>as.character</span>(<span class='no'>df_input</span>$<span class='no'>time_end</span>), <span class='fl'>1</span>, <span class='fl'>10</span>)</div><div class='output co'>#&gt; <span class='error'>Error in substr(as.character(df_input$time_end), 1, 10): objet 'df_input' introuvable</span></div><div class='input'><span class='fu'>colnames</span>(<span class='no'>df_input</span>)[<span class='fu'>colnames</span>(<span class='no'>df_input</span>) <span class='kw'>==</span> <span class='st'>"catchunit"</span>] <span class='kw'>&lt;-</span> <span class='st'>"unit"</span></div><div class='output co'>#&gt; <span class='error'>Error in colnames(df_input)[colnames(df_input) == "catchunit"] &lt;- "unit": objet 'df_input' introuvable</span></div><div class='input'>
<span class='co'># Open a dataset of factors of conversion (the one used to convert units of catch in the IRD Tuna Atlas)</span>
<span class='no'>conversion_factors_dataset</span><span class='kw'>=</span><span class='st'>"https://goo.gl/KriwxV"</span>
<span class='no'>df_conversion_factor</span><span class='kw'>=</span><span class='fu'>read.csv</span>(<span class='no'>conversion_factors_dataset</span>,<span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='no'>F</span>,<span class='kw'>colClasses</span><span class='kw'>=</span><span class='st'>"character"</span>)
<span class='fu'>head</span>(<span class='no'>df_conversion_factor</span>)</div><div class='output co'>#&gt;   source_authority species gear geographic_identifier time_start   time_end
#&gt; 1             IOTC     YFT   LL                     1 1952-01-01 1953-01-01
#&gt; 2             IOTC     YFT   LL                     2 1952-01-01 1953-01-01
#&gt; 3             IOTC     YFT   LL                     3 1952-01-01 1953-01-01
#&gt; 4             IOTC     BET   LL                     1 1952-01-01 1953-01-01
#&gt; 5             IOTC     BET   LL                     2 1952-01-01 1953-01-01
#&gt; 6             IOTC     BET   LL                     3 1952-01-01 1953-01-01
#&gt;   unit unit_target  conversion_factor
#&gt; 1   NO          MT  0.048060001373291
#&gt; 2   NO          MT 0.0486800003051758
#&gt; 3   NO          MT 0.0586399993896484
#&gt; 4   NO          MT 0.0443400001525879
#&gt; 5   NO          MT 0.0443400001525879
#&gt; 6   NO          MT 0.0433499984741211</div><div class='input'>
<span class='co'># Map gears of input dataset with standard gears, and then with sardara groups of gears, to align with codes of gears used in the conversion factor dataset</span>
<span class='no'>gear_rfmos_mapping_to_standard</span><span class='kw'>&lt;-</span><span class='fu'><a href='extract_dataset.html'>extract_dataset</a></span>(<span class='no'>con</span>,<span class='fu'><a href='list_metadata_datasets.html'>list_metadata_datasets</a></span>(<span class='no'>con</span>,<span class='kw'>dataset_name</span><span class='kw'>=</span><span class='st'>"codelist_mapping_gear_iotc_isscfg_revision_1"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in nrow(metadata_dataset): impossible de trouver la fonction "list_metadata_datasets"</span></div><div class='input'><span class='no'>df_mapped</span><span class='kw'>&lt;-</span><span class='fu'><a href='map_codelist.html'>map_codelist</a></span>(<span class='no'>df_input</span>,<span class='no'>gear_rfmos_mapping_to_standard</span>,<span class='st'>"gear"</span>)$<span class='no'>df</span></div><div class='output co'>#&gt; 
#&gt;  mapping dimension gear with code list mapping</div><div class='output co'>#&gt; <span class='error'>Error in is.data.frame(x): objet 'df_input' introuvable</span></div><div class='input'><span class='no'>gear_standard_mapping_to_gear_sardara</span><span class='kw'>&lt;-</span><span class='fu'><a href='extract_dataset.html'>extract_dataset</a></span>(<span class='no'>con</span>,<span class='fu'><a href='list_metadata_datasets.html'>list_metadata_datasets</a></span>(<span class='no'>con</span>,<span class='kw'>dataset_name</span><span class='kw'>=</span><span class='st'>"codelist_mapping_gear_iotc_geargroup_tunaatlas"</span>))</div><div class='output co'>#&gt; <span class='error'>Error in nrow(metadata_dataset): impossible de trouver la fonction "list_metadata_datasets"</span></div><div class='input'><span class='no'>df_input</span><span class='kw'>&lt;-</span><span class='fu'><a href='map_codelist.html'>map_codelist</a></span>(<span class='no'>df_input</span>,<span class='no'>gear_standard_mapping_to_gear_sardara</span>,<span class='st'>"gear"</span>)$<span class='no'>df</span></div><div class='output co'>#&gt; 
#&gt;  mapping dimension gear with code list mapping</div><div class='output co'>#&gt; <span class='error'>Error in is.data.frame(x): objet 'df_input' introuvable</span></div><div class='input'>
<span class='co'># Convert units MTNO to MT and remove NOMT (we do not keep the data that were expressed in number with corresponding value in weight)</span>
<span class='no'>df_input</span>$<span class='no'>unit</span>[<span class='fu'>which</span>(<span class='no'>df_input</span>$<span class='no'>unit</span> <span class='kw'>==</span> <span class='st'>"MTNO"</span>)]<span class='kw'>&lt;-</span><span class='st'>"MT"</span></div><div class='output co'>#&gt; <span class='error'>Error in df_input$unit[which(df_input$unit == "MTNO")] &lt;- "MT": objet 'df_input' introuvable</span></div><div class='input'><span class='no'>df_input</span><span class='kw'>&lt;-</span><span class='no'>df_input</span>[!(<span class='no'>df_input</span>$<span class='no'>unit</span><span class='kw'>==</span><span class='st'>"NOMT"</span>),]</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): objet 'df_input' introuvable</span></div><div class='input'>
<span class='co'># Convert units from numbers to weight using the dataset of factors of conversion. </span>
<span class='co'># The spatial coding system used in conversion_factor (column geographic_identifier) is not the same as the one used in df_input. Hence, we set in the parameter codelist_geoidentifiers_conversion_factors the name of the spatial coding system used in df_conversion factor ("areas_conversion_factors_numtoweigth_ird").</span>
<span class='no'>df_converted</span><span class='kw'>&lt;-</span><span class='fu'>convert_units</span>(<span class='no'>con</span>, <span class='kw'>df_input</span> <span class='kw'>=</span> <span class='no'>df_input</span>, <span class='kw'>df_conversion_factor</span> <span class='kw'>=</span> <span class='no'>df_conversion_factor</span>, <span class='kw'>codelist_geoidentifiers_conversion_factors</span> <span class='kw'>=</span> <span class='st'>"areas_conversion_factors_numtoweigth_ird"</span>)</div><div class='output co'>#&gt; 
#&gt;  converting units and measures</div><div class='output co'>#&gt; <span class='error'>Error in data.table(df_input): objet 'df_input' introuvable</span></div><div class='input'>
<span class='co'># Get the dataframe with units converted: data that were expressed in number are converted to metric tons. Some data might not be converted at all because no conversion factor exists for the stratum: these data are kept in their original unit (in this case, number).</span>
<span class='no'>df_converted_df</span><span class='kw'>&lt;-</span><span class='no'>df_converted</span>$<span class='no'>df</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): objet 'df_converted' introuvable</span></div><div class='input'><span class='fu'>head</span>(<span class='no'>df_converted_df</span>)</div><div class='output co'>#&gt; <span class='error'>Error in head(df_converted_df): objet 'df_converted_df' introuvable</span></div><div class='input'>
<span class='co'># Get information regarding the conversion (data converted, data not converted because no factor of conversion existed, etc.)</span>
<span class='no'>df_converted</span>$<span class='no'>stats</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): objet 'df_converted' introuvable</span></div><div class='input'>
<span class='fu'>dbDisconnect</span>(<span class='no'>con</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Paul Taconet, <a href='mailto:paul.taconet@ird.fr'>paul.taconet@ird.fr</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Paul Taconet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
